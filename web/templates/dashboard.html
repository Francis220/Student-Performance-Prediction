<!-- templates/dashboard.html -->
{% extends "base.html" %}
{% block title %}Class Dashboard - Student Performance Prediction{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap align-items-center mb-4">
  <h1 class="h2"><i class="fas fa-chalkboard-teacher"></i> My Class Dashboard</h1>
  <a href="{{ url_for('predict_page') }}" class="btn" style="background: var(--clr-accent); color: var(--clr-text); border-radius: 1rem;">
    <i class="fas fa-upload"></i> Upload Class Data
  </a>
</div>

<div class="row g-4 mb-5">
  <div class="col-md-6 col-xl-3">
    <div class="metric-card">
      <div class="metric-number">{{ total_students }}</div>
      <div class="metric-label">Total Students</div>
    </div>
  </div>
  <div class="col-md-6 col-xl-3">
    <div class="metric-card">
      <div class="metric-number">{{ high_risk_count }}</div>
      <div class="metric-label">High Risk</div>
    </div>
  </div>
  <div class="col-md-6 col-xl-3">
    <div class="metric-card">
      <div class="metric-number">{{ medium_risk_count }}</div>
      <div class="metric-label">Medium Risk</div>
    </div>
  </div>
  <div class="col-md-6 col-xl-3">
    <div class="metric-card">
      <div class="metric-number">{{ low_risk_count }}</div>
      <div class="metric-label">Low Risk</div>
    </div>
  </div>
</div>

<div class="card mb-5">
  <div class="card-header">
    <i class="fas fa-users"></i> Class Risk Overview
  </div>
  <div class="card-body">
    <nav>
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#nav-high">
          <i class="fas fa-exclamation-triangle" style="color: var(--clr-high)"></i>
          High Risk ({{ high_risk_count }})
        </button>
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-medium">
          <i class="fas fa-exclamation-circle" style="color: var(--clr-medium)"></i>
          Medium Risk ({{ medium_risk_count }})
        </button>
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-low">
          <i class="fas fa-check-circle" style="color: var(--clr-accent)"></i>
          Low Risk ({{ low_risk_count }})
        </button>
      </div>
    </nav>
    <div class="tab-content mt-4">
      <div class="tab-pane fade show active" id="nav-high">
        <div class="row g-3">
          {% for student in high_risk_students %}
          <div class="col-md-4">
            <div class="card border-0">
              <div class="card-header" style="background: var(--clr-high); color: var(--clr-text);">
                {{ student.id }}
              </div>
              <div class="card-body">
                <small class="text-muted">Primary Risk Factors:</small>
                <div class="mt-2">
                  {% for factor in student.factors %}
                  <span class="badge badge-high me-1">{{ factor }}</span>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        <div class="mt-4">
          {% if high_risk_students|length == 0 %}
          <div class="alert alert-success">No high-risk students identified.</div>
          {% else %}
          <div class="alert" style="background: var(--clr-high); color: var(--clr-text);">
            <i class="fas fa-exclamation-triangle"></i> Action Required: Provide targeted support.
          </div>
          {% endif %}
        </div>
      </div>

      <div class="tab-pane fade" id="nav-medium">
        <div class="alert" style="background: var(--clr-medium); color: var(--clr-text);">
          <i class="fas fa-eye"></i> Monitor Closely
        </div>
        <table class="table mt-3">
          <thead>
            <tr><th>Student</th><th>Risk Factors</th><th>Status</th></tr>
          </thead>
          <tbody>
            {% for student in medium_risk_students %}
            <tr>
              <td>{{ student.id }}</td>
              <td>
                {% for factor in student.factors %}
                <span class="badge badge-medium me-1">{{ factor }}</span>
                {% endfor %}
              </td>
              <td><span class="badge badge-medium">Monitor</span></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="tab-pane fade" id="nav-low">
        <div class="alert" style="background: var(--clr-accent); color: var(--clr-text);">
          <i class="fas fa-check-circle"></i> On Track
        </div>
        <ul class="list-group">
          {% for student in low_risk_students %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ student.id }}
            <span class="badge badge-low">Good</span>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
